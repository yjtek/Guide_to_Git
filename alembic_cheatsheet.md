# Alembic Cheat Sheet

## Init Alembic
- `alembic init alembic_dir`
- Import `Base = declarative_base()` used for your DB into `alembic_dir/env.py`, and do `target_metadata = Base.metadata`
- Update `sqlalchemy.url` = '<your db url>' in `alembic.ini`
- In `alembic_dir/env.py`, set `config.set_main_option("sqlalchemy.url", "<your db url>")`

## Using Alembic to make DB changes
- `alembic revision --help` --> Main entrypoint
- `alembic revision -m "create new helloworld table"`
  - Creates new <hash id>.py file under versions dir
  - Make all programmatic changes to the table using the `upgrade` and `downgrade` methods

## "COMMIT" changes using alembic
- `alembic upgrade/downgrade <revision str>` --> runs the `upgrade()/downgrade()` method you defined in the specific revision file
  - Or `alembic upgrade/downgrade head` also works, if you are only interested in running the latest defined revision
- You can also do relative upgrades and downgrades
  - `alembic upgrade/downgrade +-1`
- If you want to know which "revision" you are at, just do `alembic current`

## Intelligent alembic build
- Alembic doesn't need you to specify builds automatically.
- So long as you have a properly defined db metadata (i.e. whaever you passed in under Init Alembic), it will autogenerate the upgrade and downgrade functions for you based on what is missing!!
- `alembic revision --autogenerate -m "autogenerate database changes"`
- Then just `alembic upgrade head` to push the autogenerated changes
- In any `stg/prd` deployments, to start up, just add `alembic upgrade head`!
